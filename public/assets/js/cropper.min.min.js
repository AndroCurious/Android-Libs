/*
 * Cropper v0.7.6
 * https://github.com/fengyuanchen/cropper
 *
 * Copyright 2014 Fengyuan Chen
 * Released under the MIT license
 */
!function(b){"function"==typeof define&&define.amd?define(["jquery"],b):b("object"==typeof exports?require("jquery"):jQuery)}(function(aI){var aH=aI(window),aG=aI(document),aF=window.location,aE=!0,aD=!1,aC=null,aB=0/0,aA=1/0,az="undefined",ay="directive",ax=".cropper",aw=/^(e|n|w|s|ne|nw|sw|se|all|crop|move|zoom)$/,av=/^(x|y|width|height)$/,au=/^(naturalWidth|naturalHeight|width|height|aspectRatio|ratio|rotate)$/,at="cropper-modal",ar="cropper-hidden",aq="cropper-invisible",ap="cropper-move",ao="cropper-crop",an="cropper-disabled",am="mousedown touchstart",al="mousemove touchmove",ak="mouseup mouseleave touchend touchleave touchcancel",aj="wheel mousewheel DOMMouseScroll",ai="resize"+ax,ah="dblclick",ag="build"+ax,af="built"+ax,ae="dragstart"+ax,ad="dragmove"+ax,ac="dragend"+ax,ab=function(b){return"number"==typeof b},aa=function(e,d){var f=[];return"number"==typeof d&&f.push(d),f.slice.apply(e,f)},Z=function(e,d){var f=aa(arguments,2);return function(){return e.apply(d,f.concat(aa(arguments)))}},Y=function(a,d){this.element=a,this.$element=aI(a),this.defaults=aI.extend({},Y.DEFAULTS,aI.isPlainObject(d)?d:{}),this.$original=aC,this.ready=aD,this.built=aD,this.cropped=aD,this.rotated=aD,this.disabled=aD,this.replaced=aD,this.init()},X=Math.sqrt,W=Math.min,V=Math.max,U=Math.abs,T=Math.sin,S=Math.cos,R=parseFloat;Y.prototype={constructor:Y,support:{canvas:aI.isFunction(aI("<canvas>")[0].getContext)},init:function(){var a=this.defaults;aI.each(a,function(b,d){switch(b){case"aspectRatio":a[b]=U(R(d))||aB;break;case"autoCropArea":a[b]=U(R(d))||0.8;break;case"minWidth":case"minHeight":a[b]=U(R(d))||0;break;case"maxWidth":case"maxHeight":a[b]=U(R(d))||aA}}),this.image={rotate:0},this.load()},load:function(){var a,n,m=this,l=this.$element,k=this.element,j=this.image,e="";l.is("img")?n=l.prop("src"):l.is("canvas")&&this.support.canvas&&(n=k.toDataURL()),n&&(this.replaced&&(j.rotate=0),this.defaults.checkImageOrigin&&(l.prop("crossOrigin")||this.isCrossOriginURL(n))&&(e=" crossOrigin"),this.$clone=a=aI("<img"+e+' src="'+n+'">'),a.one("load",function(){j.naturalWidth=this.naturalWidth||a.width(),j.naturalHeight=this.naturalHeight||a.height(),j.aspectRatio=j.naturalWidth/j.naturalHeight,m.url=n,m.ready=aE,m.build()}),a.addClass(aq).prependTo("body"))},isCrossOriginURL:function(d){var c=d.match(/^(https?:)\/\/([^\:\/\?#]+):?(\d*)/i);return !c||c[1]===aF.protocol&&c[2]===aF.hostname&&c[3]===aF.port?aD:aE},build:function(){var a,h,f=this.$element,e=this.defaults;this.ready&&(this.built&&this.unbuild(),f.one(ag,e.build),a=aI.Event(ag),f.trigger(a),a.isDefaultPrevented()||(this.$cropper=h=aI(Y.TEMPLATE),f.addClass(ar),this.$clone.removeClass(aq).prependTo(h),this.rotated||(this.$original=this.$clone.clone(),this.$original.addClass(ar).prependTo(this.$cropper),this.originalImage=aI.extend({},this.image)),this.$container=f.parent(),this.$container.append(h),this.$canvas=h.find(".cropper-canvas"),this.$dragger=h.find(".cropper-dragger"),this.$viewer=h.find(".cropper-viewer"),e.autoCrop?this.cropped=aE:this.$dragger.addClass(ar),e.dragCrop&&this.setDragMode("crop"),e.modal&&this.$canvas.addClass(at),!e.dashed&&this.$dragger.find(".cropper-dashed").addClass(ar),!e.movable&&this.$dragger.find(".cropper-face").data(ay,"move"),!e.resizable&&this.$dragger.find(".cropper-line, .cropper-point").addClass(ar),this.addListeners(),this.initPreview(),this.built=aE,this.update(),this.replaced=aD,f.one(af,e.built),f.trigger(af)))},unbuild:function(){this.built&&(this.built=aD,this.removeListeners(),this.$preview.empty(),this.$preview=aC,this.$dragger=aC,this.$canvas=aC,this.$container=aC,this.$cropper.remove(),this.$cropper=aC)},update:function(b){this.initContainer(),this.initCropper(),this.initImage(),this.initDragger(),b?(this.setData(b,aE),this.setDragMode("crop")):this.setData(this.defaults.data)},resize:function(){clearTimeout(this.resizing),this.resizing=setTimeout(aI.proxy(this.update,this,this.getData()),200)},preview:function(){var a=this.image,l=this.dragger,k=a.width,j=a.height,i=l.left-a.left,h=l.top-a.top;this.$viewer.find("img").css({width:k,height:j,marginLeft:-i,marginTop:-h}),this.$preview.each(function(){var c=aI(this),d=c.width()/l.width;c.find("img").css({width:k*d,height:j*d,marginLeft:-i*d,marginTop:-h*d})})},addListeners:function(){var a=this.defaults;this.$element.on(ae,a.dragstart).on(ad,a.dragmove).on(ac,a.dragend),this.$cropper.on(am,aI.proxy(this.dragstart,this)).on(ah,aI.proxy(this.dblclick,this)),a.zoomable&&this.$cropper.on(aj,aI.proxy(this.wheel,this)),a.multiple?this.$cropper.on(al,aI.proxy(this.dragmove,this)).on(ak,aI.proxy(this.dragend,this)):aG.on(al,this._dragmove=Z(this.dragmove,this)).on(ak,this._dragend=Z(this.dragend,this)),aH.on(ai,this._resize=Z(this.resize,this))},removeListeners:function(){var b=this.defaults;this.$element.off(ae,b.dragstart).off(ad,b.dragmove).off(ac,b.dragend),this.$cropper.off(am,this.dragstart).off(ah,this.dblclick),b.zoomable&&this.$cropper.off(aj,this.wheel),b.multiple?this.$cropper.off(al,this.dragmove).off(ak,this.dragend):aG.off(al,this._dragmove).off(ak,this._dragend),aH.off(ai,this._resize)},initPreview:function(){var a='<img src="'+this.url+'">';this.$preview=aI(this.defaults.preview),this.$viewer.html(a),this.$preview.html(a).find("img").css("cssText","min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;")},initContainer:function(){var b=this.$container;this.container={width:V(b.width(),300),height:V(b.height(),150)}},initCropper:function(){var e,d=this.container,f=this.image;f.naturalWidth*d.height/f.naturalHeight-d.width>=0?(e={width:d.width,height:d.width/f.aspectRatio,left:0},e.top=(d.height-e.height)/2):(e={width:d.height*f.aspectRatio,height:d.height,top:0},e.left=(d.width-e.width)/2),this.$cropper.css({width:e.width,height:e.height,left:e.left,top:e.top}),this.cropper=e},initImage:function(){var a=this.image,f=this.cropper,e={_width:f.width,_height:f.height,width:f.width,height:f.height,left:0,top:0,ratio:f.width/a.naturalWidth};this.defaultImage=aI.extend({},a,e),a._width!==f.width||a._height!==f.height?aI.extend(a,e):(a=aI.extend({},e,a),this.replaced&&(a.ratio=e.ratio)),this.image=a,this.renderImage()},renderImage:function(d){var c=this.image;"zoom"===d&&(c.left-=(c.width-c.oldWidth)/2,c.top-=(c.height-c.oldHeight)/2),c.left=W(V(c.left,c._width-c.width),0),c.top=W(V(c.top,c._height-c.height),0),this.$clone.css({width:c.width,height:c.height,marginLeft:c.left,marginTop:c.top}),d&&(this.defaults.done(this.getData()),this.preview())},initDragger:function(){var a,j=this.defaults,i=this.cropper,h=j.aspectRatio||this.image.aspectRatio,g=this.image.ratio;a=i.height*h-i.width>=0?{height:i.width/h,width:i.width,left:0,top:(i.height-i.width/h)/2,maxWidth:i.width,maxHeight:i.width/h}:{height:i.height,width:i.height*h,left:(i.width-i.height*h)/2,top:0,maxWidth:i.height*h,maxHeight:i.height},a.minWidth=0,a.minHeight=0,j.aspectRatio?(isFinite(j.maxWidth)?(a.maxWidth=W(a.maxWidth,j.maxWidth*g),a.maxHeight=a.maxWidth/h):isFinite(j.maxHeight)&&(a.maxHeight=W(a.maxHeight,j.maxHeight*g),a.maxWidth=a.maxHeight*h),j.minWidth>0?(a.minWidth=V(0,j.minWidth*g),a.minHeight=a.minWidth/h):j.minHeight>0&&(a.minHeight=V(0,j.minHeight*g),a.minWidth=a.minHeight*h)):(a.maxWidth=W(a.maxWidth,j.maxWidth*g),a.maxHeight=W(a.maxHeight,j.maxHeight*g),a.minWidth=V(0,j.minWidth*g),a.minHeight=V(0,j.minHeight*g)),a.minWidth=W(a.maxWidth,a.minWidth),a.minHeight=W(a.maxHeight,a.minHeight),a.height*=j.autoCropArea,a.width*=j.autoCropArea,a.left=(i.width-a.width)/2,a.top=(i.height-a.height)/2,a.oldLeft=a.left,a.oldTop=a.top,this.defaultDragger=a,this.dragger=aI.extend({},a)},renderDragger:function(){var d=this.dragger,c=this.cropper;d.width>d.maxWidth?(d.width=d.maxWidth,d.left=d.oldLeft):d.width<d.minWidth&&(d.width=d.minWidth,d.left=d.oldLeft),d.height>d.maxHeight?(d.height=d.maxHeight,d.top=d.oldTop):d.height<d.minHeight&&(d.height=d.minHeight,d.top=d.oldTop),d.left=W(V(d.left,0),c.width-d.width),d.top=W(V(d.top,0),c.height-d.height),d.oldLeft=d.left,d.oldTop=d.top,this.dragger=d,this.disabled||this.defaults.done(this.getData()),this.$dragger.css({width:d.width,height:d.height,left:d.left,top:d.top}),this.preview()},reset:function(a){this.cropped&&(a&&(this.defaults.data={}),this.image=aI.extend({},this.defaultImage),this.renderImage(),this.dragger=aI.extend({},this.defaultDragger),this.setData(this.defaults.data))},clear:function(){this.cropped&&(this.cropped=aD,this.setData({x:0,y:0,width:0,height:0}),this.$canvas.removeClass(at),this.$dragger.addClass(ar))},destroy:function(){var b=this.$element;this.ready&&(this.unbuild(),b.removeClass(ar).removeData("cropper"),this.rotated&&b.attr("src",this.$original.attr("src")))},replace:function(a,l){var k,j=this,f=this.$element,e=this.element;a&&a!==this.url&&a!==f.attr("src")&&(l||(this.rotated=aD,this.replaced=aE),f.is("img")?(f.attr("src",a),this.load()):f.is("canvas")&&this.support.canvas&&(k=e.getContext("2d"),aI('<img src="'+a+'">').one("load",function(){e.width=this.width,e.height=this.height,k.clearRect(0,0,e.width,e.height),k.drawImage(this,0,0),j.load()})))},setData:function(a,l){var k=this.cropper,j=this.dragger,i=this.image,g=this.defaults.aspectRatio;this.built&&typeof a!==az&&((a===aC||aI.isEmptyObject(a))&&(j=aI.extend({},this.defaultDragger)),aI.isPlainObject(a)&&!aI.isEmptyObject(a)&&(l||(this.defaults.data=a),a=this.transformData(a),ab(a.x)&&a.x<=k.width-i.left&&(j.left=a.x+i.left),ab(a.y)&&a.y<=k.height-i.top&&(j.top=a.y+i.top),g?ab(a.width)&&a.width<=j.maxWidth&&a.width>=j.minWidth?(j.width=a.width,j.height=j.width/g):ab(a.height)&&a.height<=j.maxHeight&&a.height>=j.minHeight&&(j.height=a.height,j.width=j.height*g):(ab(a.width)&&a.width<=j.maxWidth&&a.width>=j.minWidth&&(j.width=a.width),ab(a.height)&&a.height<=j.maxHeight&&a.height>=j.minHeight&&(j.height=a.height))),this.dragger=j,this.renderDragger())},getData:function(f){var e=this.dragger,h=this.image,g={};return this.built&&(g={x:e.left-h.left,y:e.top-h.top,width:e.width,height:e.height},g=this.transformData(g,aE,f)),g},transformData:function(a,j,i){var h=this.image.ratio,g={};return aI.each(a,function(d,c){c=R(c),av.test(d)&&!isNaN(c)&&(g[d]=j?i?Math.round(c/h):c/h:c*h)}),g},setAspectRatio:function(d){var c="auto"===d;d=R(d),(c||!isNaN(d)&&d>0)&&(this.defaults.aspectRatio=c?aB:d,this.built&&(this.initDragger(),this.renderDragger()))},getImageData:function(){var a={};return this.ready&&aI.each(this.image,function(b,d){au.test(b)&&(a[b]=d)}),a},getDataURL:function(a,n,m){var l,k=aI("<canvas>")[0],j=this.getData(),i="";return aI.isPlainObject(a)||(m=n,n=a,a={}),a=aI.extend({width:j.width,height:j.height},a),this.cropped&&this.support.canvas&&(k.width=a.width,k.height=a.height,l=k.getContext("2d"),"image/jpeg"===n&&(l.fillStyle="#fff",l.fillRect(0,0,a.width,a.height)),l.drawImage(this.$clone[0],j.x,j.y,j.width,j.height,0,0,a.width,a.height),i=k.toDataURL(n,m)),i},setDragMode:function(f){var e=this.$canvas,j=this.defaults,i=aD,h=aD;if(this.built&&!this.disabled){switch(f){case"crop":j.dragCrop&&(i=aE,e.data(ay,f));break;case"move":h=aE,e.data(ay,f);break;default:e.removeData(ay)}e.toggleClass(ao,i).toggleClass(ap,h)}},enable:function(){this.built&&(this.disabled=aD,this.$cropper.removeClass(an))},disable:function(){this.built&&(this.disabled=aE,this.$cropper.addClass(an))},rotate:function(d){var c=this.image;d=R(d)||0,this.built&&0!==d&&!this.disabled&&this.defaults.rotatable&&this.support.canvas&&(this.rotated=aE,d=c.rotate=(c.rotate+d)%360,this.replace(this.getRotatedDataURL(d),!0))},getRotatedDataURL:function(x){var w=aI("<canvas>")[0],v=w.getContext("2d"),u=x*Math.PI/180,t=U(x)%180,s=t>90?180-t:t,r=s*Math.PI/180,q=this.originalImage,p=q.naturalWidth,o=q.naturalHeight,n=U(p*S(r)+o*T(r)),a=U(p*T(r)+o*S(r));return w.width=n,w.height=a,v.save(),v.translate(n/2,a/2),v.rotate(u),v.drawImage(this.$original[0],-p/2,-o/2,p,o),v.restore(),w.toDataURL()},zoom:function(g){var f,j,i,h=this.image;g=R(g),this.built&&g&&!this.disabled&&this.defaults.zoomable&&(f=h.width*(1+g),j=h.height*(1+g),i=f/h._width,i>10||(1>i&&(f=h._width,j=h._height),this.setDragMode(1>=i?"crop":"move"),h.oldWidth=h.width,h.oldHeight=h.height,h.width=f,h.height=j,h.ratio=h.width/h.naturalWidth,this.renderImage("zoom")))},dblclick:function(){this.disabled||this.setDragMode(this.$canvas.hasClass(ao)?"move":"crop")},wheel:function(i){var h,n=i.originalEvent,m=117.25,l=5,k=166.66665649414062,j=0.1;this.disabled||(i.preventDefault(),n.deltaY?(h=n.deltaY,h=h%l===0?h/l:h%m===0?h/m:h/k):h=n.wheelDelta?-n.wheelDelta/120:n.detail?n.detail/3:0,this.zoom(h*j))},dragstart:function(a){var l,k,j,f=a.originalEvent.touches,e=a;if(!this.disabled){if(f){if(j=f.length,j>1){if(!this.defaults.zoomable||2!==j){return}e=f[1],this.startX2=e.pageX,this.startY2=e.pageY,l="zoom"}e=f[0]}if(l=l||aI(e.target).data(ay),aw.test(l)){if(a.preventDefault(),k=aI.Event(ae),this.$element.trigger(k),k.isDefaultPrevented()){return}this.directive=l,this.cropping=aD,this.startX=e.pageX,this.startY=e.pageY,"crop"===l&&(this.cropping=aE,this.$canvas.addClass(at))}}},dragmove:function(a){var j,i,h=a.originalEvent.touches,g=a;if(!this.disabled){if(h){if(i=h.length,i>1){if(!this.defaults.zoomable||2!==i){return}g=h[1],this.endX2=g.pageX,this.endY2=g.pageY}g=h[0]}if(this.directive){if(a.preventDefault(),j=aI.Event(ad),this.$element.trigger(j),j.isDefaultPrevented()){return}this.endX=g.pageX,this.endY=g.pageY,this.dragging()}}},dragend:function(a){var d;if(!this.disabled&&this.directive){if(a.preventDefault(),d=aI.Event(ac),this.$element.trigger(d),d.isDefaultPrevented()){return}this.cropping&&(this.cropping=aD,this.$canvas.toggleClass(at,this.cropped&&this.defaults.modal)),this.directive=""}},dragging:function(){var F,E=this.directive,D=this.image,C=this.cropper,B=C.width,A=C.height,z=this.dragger,y=z.width,x=z.height,w=z.left,v=z.top,u=w+y,q=v+x,f=aE,e=this.defaults,H=e.aspectRatio,G={x:this.endX-this.startX,y:this.endY-this.startY};switch(H&&(G.X=G.y*H,G.Y=G.x/H),E){case"all":w+=G.x,v+=G.y;break;case"e":if(G.x>=0&&(u>=B||H&&(0>=v||q>=A))){f=aD;break}y+=G.x,H&&(x=y/H,v-=G.Y/2),0>y&&(E="w",y=0);break;case"n":if(G.y<=0&&(0>=v||H&&(0>=w||u>=B))){f=aD;break}x-=G.y,v+=G.y,H&&(y=x*H,w+=G.X/2),0>x&&(E="s",x=0);break;case"w":if(G.x<=0&&(0>=w||H&&(0>=v||q>=A))){f=aD;break}y-=G.x,w+=G.x,H&&(x=y/H,v+=G.Y/2),0>y&&(E="e",y=0);break;case"s":if(G.y>=0&&(q>=A||H&&(0>=w||u>=B))){f=aD;break}x+=G.y,H&&(y=x*H,w-=G.X/2),0>x&&(E="n",x=0);break;case"ne":if(H){if(G.y<=0&&(0>=v||u>=B)){f=aD;break}x-=G.y,v+=G.y,y=x*H}else{G.x>=0?B>u?y+=G.x:G.y<=0&&0>=v&&(f=aD):y+=G.x,G.y<=0?v>0&&(x-=G.y,v+=G.y):(x-=G.y,v+=G.y)}0>x&&(E="sw",x=0,y=0);break;case"nw":if(H){if(G.y<=0&&(0>=v||0>=w)){f=aD;break}x-=G.y,v+=G.y,y=x*H,w+=G.X}else{G.x<=0?w>0?(y-=G.x,w+=G.x):G.y<=0&&0>=v&&(f=aD):(y-=G.x,w+=G.x),G.y<=0?v>0&&(x-=G.y,v+=G.y):(x-=G.y,v+=G.y)}0>x&&(E="se",x=0,y=0);break;case"sw":if(H){if(G.x<=0&&(0>=w||q>=A)){f=aD;break}y-=G.x,w+=G.x,x=y/H}else{G.x<=0?w>0?(y-=G.x,w+=G.x):G.y>=0&&q>=A&&(f=aD):(y-=G.x,w+=G.x),G.y>=0?A>q&&(x+=G.y):x+=G.y}0>y&&(E="ne",x=0,y=0);break;case"se":if(H){if(G.x>=0&&(u>=B||q>=A)){f=aD;break}y+=G.x,x=y/H}else{G.x>=0?B>u?y+=G.x:G.y>=0&&q>=A&&(f=aD):y+=G.x,G.y>=0?A>q&&(x+=G.y):x+=G.y}0>y&&(E="nw",x=0,y=0);break;case"move":D.left+=G.x,D.top+=G.y,this.renderImage("move"),f=aD;break;case"zoom":e.zoomable&&(this.zoom(function(h,g,l,k,j,i){return(X(j*j+i*i)-X(l*l+k*k))/X(h*h+g*g)}(D.width,D.height,U(this.startX-this.startX2),U(this.startY-this.startY2),U(this.endX-this.endX2),U(this.endY-this.endY2))),this.endX2=this.startX2,this.endY2=this.startY2);break;case"crop":G.x&&G.y&&(F=this.$cropper.offset(),w=this.startX-F.left,v=this.startY-F.top,y=z.minWidth,x=z.minHeight,G.x>0?G.y>0?E="se":(E="ne",v-=x):G.y>0?(E="sw",w-=y):(E="nw",w-=y,v-=x),this.cropped||(this.cropped=aE,this.$dragger.removeClass(ar)))}f&&(z.width=y,z.height=x,z.left=w,z.top=v,this.directive=E,this.renderDragger()),this.startX=this.endX,this.startY=this.endY}},Y.TEMPLATE=function(d,c){return c=c.split(","),d.replace(/\d+/g,function(b){return c[b]})}('<0 6="5-container"><0 6="5-canvas"></0><0 6="5-dragger"><1 6="5-viewer"></1><1 6="5-8 8-h"></1><1 6="5-8 8-v"></1><1 6="5-face" 3-2="all"></1><1 6="5-7 7-e" 3-2="e"></1><1 6="5-7 7-n" 3-2="n"></1><1 6="5-7 7-w" 3-2="w"></1><1 6="5-7 7-s" 3-2="s"></1><1 6="5-4 4-e" 3-2="e"></1><1 6="5-4 4-n" 3-2="n"></1><1 6="5-4 4-w" 3-2="w"></1><1 6="5-4 4-s" 3-2="s"></1><1 6="5-4 4-ne" 3-2="ne"></1><1 6="5-4 4-nw" 3-2="nw"></1><1 6="5-4 4-sw" 3-2="sw"></1><1 6="5-4 4-se" 3-2="se"></1></0></0>',"div,span,directive,data,point,cropper,class,line,dashed"),Y.DEFAULTS={aspectRatio:"auto",autoCropArea:0.8,data:{},done:aI.noop,preview:"",multiple:aD,autoCrop:aE,dragCrop:aE,dashed:aE,modal:aE,movable:aE,resizable:aE,zoomable:aE,rotatable:aE,checkImageOrigin:aE,minWidth:0,minHeight:0,maxWidth:aA,maxHeight:aA,build:aC,built:aC,dragstart:aC,dragmove:aC,dragend:aC},Y.setDefaults=function(a){aI.extend(Y.DEFAULTS,a)},Y.other=aI.fn.cropper,aI.fn.cropper=function(a){var f,e=aa(arguments,1);return this.each(function(){var d,c=aI(this),b=c.data("cropper");b||c.data("cropper",b=new Y(this,a)),"string"==typeof a&&aI.isFunction(d=b[a])&&(f=d.apply(b,e))}),typeof f!==az?f:this},aI.fn.cropper.Constructor=Y,aI.fn.cropper.setDefaults=Y.setDefaults,aI.fn.cropper.noConflict=function(){return aI.fn.cropper=Y.other,this}});